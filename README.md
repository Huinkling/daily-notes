# 🌱 模型训练日志  
📅 日期：2025-05-15
👤 负责人：Ink

# **模型训练日志**

## **训练过程改进：**
- **优化了学习率调度器**：使用了 `ReduceLROnPlateau`，根据验证损失调整学习率，保持模型训练稳定。
- **引入了早停（Early Stopping）机制**：避免了过拟合，确保训练在验证集上达到最佳性能后停止。
- **使用了数据增强**：通过随机裁剪、翻转、旋转等手段增强了训练数据，使模型能够更好地泛化。
- **调整了 batch size**：从 16 增加到 32，提升了训练效率，同时保证了内存使用的合理性。
- **采用混合精度训练**：通过启用混合精度训练（float16），提高了训练速度和效率。
- **改进了损失函数**：使用了加权损失函数处理类别不平衡问题，确保了每个类别的模型都能学习到有效特征。

---

## **最终训练结果与理想指标对比：**

### **训练指标：**
- **训练损失（Loss）**: `0.0637`  
- **位置准确率（Pos Acc）**: `98.06%`  
- **等级 MAE**: `0.1521`

### **验证指标：**
- **验证损失（Loss）**: `0.0277`  
- **位置准确率（Pos Acc）**: `98.90%`  
- **F1 分数**: `0.9891`  
- **等级 MAE**: `0.0736`  
- **各类别 F1**:  
  - 类别 1: `0.9825`  
  - 类别 2: `1.0000`  
  - 类别 3: `0.9848`

### **理想指标对比：**
| 指标                  | 理想目标             | 当前结果           | 评价     |
|-----------------------|----------------------|--------------------|----------|
| **训练损失**           | ≤ 0.20               | 0.0637             | 极优     |
| **训练位置准确率**     | ≥ 85%                | 98.06%             | 极优     |
| **训练等级 MAE**       | ≤ 0.20               | 0.1521             | 极优     |
| **验证损失**           | ≤ 0.20               | 0.0277             | 极优     |
| **验证位置准确率**     | ≥ 85%                | 98.90%             | 极优     |
| **验证 F1 分数**       | ≥ 0.80               | 0.9891             | 极优     |
| **验证等级 MAE**       | ≤ 0.20               | 0.0736             | 极优     |
| **各类别 F1**          | ≥ 0.60               | 0.9825 / 1.0000 / 0.9848 | 极优     |

---

## **总结与评价：**
- **性能显著提升**：模型在 **训练集** 和 **验证集** 上均表现出色，尤其是在 **验证损失** 和 **F1 分数** 上，表现优于预期。
- **训练时间优化**：通过优化批次大小、学习率调度和使用混合精度训练，训练效率得到显著提升。
- **模型泛化能力增强**：验证集表现非常好，F1 分数接近 1，表明模型能够准确区分各类别，且不容易过拟合。
- **数据增强与优化**：数据增强和合理的损失函数权重调整显著提高了模型的稳定性和鲁棒性。

---

### **未来步骤：**
- 继续监控模型在实际部署中的表现，确保其在不同数据上的泛化能力。
- 在需要时，可以进行微调，以应对 **样本变化** 或 **新数据**。

---


# 🌱 模型训练日志  
📅 日期：2025-05-13
👤 负责人：Ink

## 训练概况
- **模型**: 增强版 ResNet
- **训练轮数**: 9-10轮
- **数据集**: 9 类病害样本数据（共约 900 张 `.tif` 图像）
- **损失函数**: Focal Loss
- **优化器**: Adam（学习率：0.001）
- **训练参数**: 批次大小 32, 学习率调度：ReduceLROnPlateau
- **正则化**: 使用 Dropout 和 BatchNorm

---

## 训练结果

### 1. **损失（Loss）**
| **指标**       | **训练集** | **验证集**  | **备注**               |
|----------------|------------|-------------|------------------------|
| **最佳验证损失**   | 0.4082     | 0.4236      | 验证损失较低，模型收敛 |
| **训练损失**      | 2.0083     | 1.7918      | 初始损失较高，合理     |
| **最终验证损失**   | 0.4236     | 0.4236      | 稳定收敛，略微过拟合    |

### 2. **位置分类**
| **指标**             | **训练集**  | **验证集**   | **备注**                 |
|----------------------|-------------|--------------|--------------------------|
| **位置准确率**       | 52.75%      | 52.75%       | 显著提升，但仍有提高空间 |
| **位置 F1 分数**     | 0.5207      | 0.5207       | 较好的 F1 分数           |

### 3. **等级预测（MAE）**
| **指标**          | **训练集**  | **验证集**  | **备注**                |
|-------------------|-------------|-------------|-------------------------|
| **等级 MAE**      | 0.5001      | 0.5001      | 较小的 MAE，表现优秀    |

---

## 评判标准

- **总损失（Loss）**: 训练损失和验证损失逐渐下降，验证损失波动说明模型有轻微过拟合。最佳验证损失 0.4236 低于 1.0，符合预期。
- **位置准确率（Pos Acc）**: 模型准确率从 33.7% 提升到 52.75%，已显示出模型在分类上的学习能力。
- **位置 F1 分数**: F1 分数从 0.29 提升至 0.52，表明模型能较好地平衡分类的精度和召回。
- **等级 MAE**: 从 1.7 降至 0.5，模型对等级的预测非常准确，接近理想水平。

---

## 主观评判

- **优于预期**: 
  - 模型在 **病害等级预测**（MAE = 0.5）方面表现非常好，已经达到了实际应用中的要求。
  - **位置分类准确率** 也有了显著的提高，从 **初期 33.7%** 提升到 **52.75%**，符合预期中的进步。
  - 总体来看，验证损失较低，模型正在收敛。

- **待改进**:
  - **过拟合迹象**：虽然验证损失低，但训练和验证损失波动说明可能存在过拟合，需要加强正则化。
  - **位置准确率**：虽然提升明显，但目标位置分类准确率应达到 60% 以上，因此仍有提升空间。
  - **F1 分数**：虽然从 0.29 提升到 0.52，但理想情况下，F1 分数应在 **0.6~0.75** 之间，位置分类任务的提升空间较大。

---

## 改进措施

### 1. **避免过拟合**
- **使用 Early Stopping**：在验证损失不再显著下降时停止训练，防止过拟合。
- **增加正则化**：尝试增大 Dropout 比例，或增加 L2 正则化。

### 2. **提升位置分类准确率**
- **数据增强**：引入更多的图像增强技术，如随机裁剪、旋转、镜像等，以增加训练样本的多样性。
- **调整模型结构**：可以尝试使用更深的网络，或加入其他特征（例如纹理、形状等）。

### 3. **进一步优化学习率**
- **调整学习率调度**：虽然使用了 `ReduceLROnPlateau`，但可以进一步调整学习率下降的策略，避免过快收敛或震荡。

### 4. **优化模型训练流程**
- **混合精度训练（FP16）**：启用混合精度训练，以减少内存使用并加速计算，特别是使用像 RTX 6000 这样的高端 GPU 时。
- **增加 `num_workers`**：提高 `DataLoader` 的并行度，加速数据加载和预处理过程。

---

### 结论

整体上，模型已经达到了**预期以上**的性能，尤其在 **等级预测（MAE = 0.5）** 上表现非常好。**位置分类任务**的准确率和 F1 分数有所提升，但仍然有进一步优化的空间。接下来，重点是**加强正则化、增加数据增强**，以及**进一步减少过拟合**，确保模型在大规模数据集上的表现。

---


# 🌱 模型训练日志  
📅 日期：2025-05-11
👤 负责人：Ink
📂 项目：玉米病害多任务识别模型full-size（位置 + 等级）

## 训练思路

### 目标：
- **训练全部样本数据**：在 `14l/m/t` 小样本训练的基础上，**扩展到 9 类数据集**（`9l`, `9m`, `9t`, `14l`, `14m`, `14t`, `19l`, `19m`, `19t`）。
- **修正目标标签**：将标签维度从 `(batch_size, 1)` 修正为 `(batch_size,)`，确保与模型输出匹配。
- **启用混合精度训练**：使用 **FP16** 训练，利用 RTX 6000 的 **Tensor Cores** 加速计算，减少显存占用。
- **优化模型性能**：通过数据预处理、`num_workers` 增加、混合精度训练等方法，提高训练速度和模型泛化能力。

---

## 训练目标

1. **位置任务**：
   - **预测感染部位**（下部、中部、上部）  
   - 目标：尽可能提高位置准确率（`Position Accuracy`）和 F1 分数（`Position F1`）。
   
2. **等级任务**：
   - **预测病害等级**（0、3、5、7、9）  
   - 目标：尽可能减少 MAE（`Mean Absolute Error`），并提高分类准确性。

3. **混合精度训练**：
   - 利用 **RTX 6000** 显卡的 **Tensor Cores**，通过 **FP16**（混合精度训练）加速训练，减少内存占用。

---

## 训练指标与含义

| 指标 | 含义 | 描述 |
|------|------|------|
| **训练损失 (Loss)** | 训练误差 | 衡量模型在训练数据上的拟合程度，越低越好 |
| **验证损失 (Val Loss)** | 验证误差 | 衡量模型在验证集上的泛化能力，越低越好 |
| **位置准确率 (Position Accuracy)** | 正确预测感染部位的比例 | 用于评估模型在预测感染部位任务上的精度 |
| **位置 F1 分数 (Position F1)** | 位置预测的精确度和召回率综合分数 | 更全面衡量位置任务的预测能力 |
| **等级 MAE (Grade MAE)** | 预测的病害等级与真实值之间的平均绝对误差 | 衡量等级任务预测的准确度，越低越好 |

---

## 训练日志关键数据

### 训练集：
| 指标 | 当前值 | 上一轮 | 变化幅度 | 评价 |
|------|--------|--------|----------|------|
| **训练损失** | 1.3215 | 2.0083 | **下降了 34%** | 显著进步，说明模型开始有效拟合 |
| **位置准确率** | 0.3893 | 0.3370 | **提高了 5%** | 正在逐步提升，但仍低于理想值（0.5） |
| **位置 F1 分数** | 0.3584 | 0.2901 | **提高了 7%** | 位置任务仍需优化，但已超过随机水平 |
| **等级 MAE** | 1.3864 | 1.7982 | **下降了 23%** | 病害等级预测的误差显著下降，开始更准确拟合 |

### 验证集：
| 指标 | 当前值 | 上一轮 | 变化幅度 | 评价 |
|------|--------|--------|----------|------|
| **验证损失** | 1.2371 | 1.7918 | **下降了 31%** | 验证集表现改善，模型泛化性增强 |
| **位置准确率** | 0.3956 | 0.2967 | **提升了 10%** | 位置任务有效提升，训练模型开始收敛 |
| **位置 F1 分数** | 0.3584 | 0.2901 | **提高了 7%** | 继续提升，表现比随机猜测好 |
| **等级 MAE** | 1.3926 | 1.7268 | **下降了 19%** | 验证集病害等级预测误差逐步减少，模型学习到更多规律 |

---

## 训练进展总结

- **训练损失显著下降**，验证损失也随之减少，说明模型开始从训练数据中学习到有效特征，并且能够在验证集上泛化。
- **位置准确率和 F1 分数**有了**可观提升**，但是仍然低于理想值（>0.5），这意味着模型还在学习过程中，但进展非常积极。
- **等级 MAE 下降幅度大**，说明病害等级任务开始拟合，误差缩小，接近收敛。

### **模型的泛化能力**：
- 训练集和验证集的损失都在下降，验证集的准确率提升了 10%，表明模型在**过拟合问题**上得到控制，具备了一定的**泛化能力**。

---

## 下一步策略

### 1. **继续训练**：
   - **观察第 5~10 轮**的进一步进展，特别是位置任务的准确率和 F1 分数是否能进一步提高。

### 2. **优化数据加载**：
   - 如果仍有 I/O 瓶颈，尝试增加 `num_workers`，并且使用 `.npy` 或 `.pt` 格式的数据，减少 I/O 延迟。

### 3. **标签修正**：
   - 已修正标签维度问题，确保目标标签和模型输出一致，避免再出现维度不匹配警告。

### 4. **混合精度训练**：
   - 在 RTX 6000 上开启混合精度训练，利用 **FP16** 提升训练速度和减少显存占用。
   - 检查训练速度的变化，并确认显存是否有改善。

### 5. **监控指标**：
   - 持续监控 **位置准确率** 和 **等级 MAE** 的变化，判断是否有继续优化的空间。

# ✅ 总结与下一步

## 当前问题分析：

1. **NotGeoreferencedWarning**：
   - 图像缺少地理参考信息，对分类任务不影响，但应优化数据加载，避免不必要的计算。

2. **目标标签维度不匹配**：
   - 修正标签维度，使其与模型输出一致，解决广播问题。

3. **训练慢**：
   - 优化数据加载并启用混合精度训练，以提高训练效率。

---

## 下一步行动：

1. **修复目标标签的维度问题**，确保标签和模型输出匹配。

2. **继续优化数据加载**：
   - 增加 `num_workers`，并将 `.tif` 转为 `.npy` 或 `.pt` 格式以加快数据加载速度。

3. **确保混合精度训练正常启用**，进一步加速训练过程。

4. **监控训练过程中的损失和准确率变化**，确保模型继续朝正确方向收敛。

---

## 总结

- **整体训练进展非常正常且有明显提升**，第一轮已经显著下降，后续训练继续观察提升空间。
- 混合精度训练和标签维度修正将进一步提高模型训练效率和精度。

---

# 🌱 模型训练日志  
📅 日期：2025-05-08  
👤 负责人：Ink  
📂 项目：玉米病害多任务识别模型mini（位置 + 等级）

---

## 🎯 当前训练思路

- 使用 ResNet-Plus 架构进行多任务学习：
  - 任务 1：病害位置分类（多类别 Softmax）
  - 任务 2：病害等级预测（0–25 回归）
- 多任务加权损失函数：
total_loss = 位置损失 × 0.7 + 等级损失 × 0.3
- 输入图像为遥感图像，标签来自 14l/m/t 三个数据源

---

## 🎯 当前阶段目标

**主攻位置任务的泛化能力，维持等级任务的稳定性能**

---

## 📊 使用训练指标

| 指标名称         | 类型     | 含义                               | 当前数据          | 评估         |
|------------------|----------|------------------------------------|-------------------|--------------|
| 位置准确率       | 分类     | 模型预测的位置类别是否正确         | 训练: 69.4%, 验证: 43.8% | 较好 |
| 位置 F1 分数     | 分类     | 综合精度与召回，衡量偏类情况       | 验证: 0.40         | 中 |
| 等级 MAE         | 回归     | 平均预测偏差（0~25）               | 训练: 0.47, 验证: 1.13 | 较好 |
| 等级 ±2容忍率    | 回归     | 等级误差在 ±2 范围视为正确         | 验证: 100%         | 好 |
| 总损失           | 综合     | 两个子任务损失加权和               | 稳定下降中         | 中 |

---

## 📌 数据规模与局限

| 项目              | 当前状态           | 说明                                   |
|-------------------|--------------------|----------------------------------------|
| 训练集规模         | 62 张图像           | 样本较小，等级任务已能稳定收敛         |
| 验证集规模         | 16 张图像           | 样本较小，指标可能波动较大             |
| 位置标签分布       | 可能不均衡          | 有些位置类别从未被预测                 |
| 等级标签结构       | 0–25 整数，0 表示健康 | 顺序性强，已通过回归建模               |

---

## ✅ 总结与建议

- ✅ 等级任务表现稳定，已达到目标；
- ⚠️ 位置任务首次验证 F1 明显上升，值得继续追踪；
- 下一步建议：
- 可视化位置预测混淆矩阵
- 使用数据增强补充位置小类样本
- 启用 EarlyStopping 和自适应学习率策略

 
