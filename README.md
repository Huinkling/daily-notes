# 🌱 模型训练日志  
📅 日期：2025-05-08  
👤 负责人：Ink  
📂 项目：玉米病害多任务识别模型mini（位置 + 等级）

---

## 🎯 当前训练思路

- 使用 ResNet-Plus 架构进行多任务学习：
  - 任务 1：病害位置分类（多类别 Softmax）
  - 任务 2：病害等级预测（0–25 回归）
- 多任务加权损失函数：
total_loss = 位置损失 × 0.7 + 等级损失 × 0.3
- 输入图像为遥感图像，标签来自 14l/m/t 三个数据源

---

## 🎯 当前阶段目标

**主攻位置任务的泛化能力，维持等级任务的稳定性能**

---

## 📊 使用训练指标

| 指标名称         | 类型     | 含义                               | 当前数据          | 评估         |
|------------------|----------|------------------------------------|-------------------|--------------|
| 位置准确率       | 分类     | 模型预测的位置类别是否正确         | 训练: 69.4%, 验证: 43.8% | 较好 |
| 位置 F1 分数     | 分类     | 综合精度与召回，衡量偏类情况       | 验证: 0.40         | 中 |
| 等级 MAE         | 回归     | 平均预测偏差（0~25）               | 训练: 0.47, 验证: 1.13 | 较好 |
| 等级 ±2容忍率    | 回归     | 等级误差在 ±2 范围视为正确         | 验证: 100%         | 好 |
| 总损失           | 综合     | 两个子任务损失加权和               | 稳定下降中         | 中 |

---

## 📌 数据规模与局限

| 项目              | 当前状态           | 说明                                   |
|-------------------|--------------------|----------------------------------------|
| 训练集规模         | 62 张图像           | 样本较小，等级任务已能稳定收敛         |
| 验证集规模         | 16 张图像           | 样本较小，指标可能波动较大             |
| 位置标签分布       | 可能不均衡          | 有些位置类别从未被预测                 |
| 等级标签结构       | 0–25 整数，0 表示健康 | 顺序性强，已通过回归建模               |

---

## ✅ 总结与建议

- ✅ 等级任务表现稳定，已达到目标；
- ⚠️ 位置任务首次验证 F1 明显上升，值得继续追踪；
- 下一步建议：
- 可视化位置预测混淆矩阵
- 使用数据增强补充位置小类样本
- 启用 EarlyStopping 和自适应学习率策略

# 🌱 模型训练日志  
📅 日期：2025-05-11
👤 负责人：Ink  

## 训练思路

### 目标：
- **训练全部样本数据**：在 `14l/m/t` 小样本训练的基础上，**扩展到 9 类数据集**（`9l`, `9m`, `9t`, `14l`, `14m`, `14t`, `19l`, `19m`, `19t`）。
- **修正目标标签**：将标签维度从 `(batch_size, 1)` 修正为 `(batch_size,)`，确保与模型输出匹配。
- **启用混合精度训练**：使用 **FP16** 训练，利用 RTX 6000 的 **Tensor Cores** 加速计算，减少显存占用。
- **优化模型性能**：通过数据预处理、`num_workers` 增加、混合精度训练等方法，提高训练速度和模型泛化能力。

---

## 训练目标

1. **位置任务**：
   - **预测感染部位**（下部、中部、上部）  
   - 目标：尽可能提高位置准确率（`Position Accuracy`）和 F1 分数（`Position F1`）。
   
2. **等级任务**：
   - **预测病害等级**（0、3、5、7、9）  
   - 目标：尽可能减少 MAE（`Mean Absolute Error`），并提高分类准确性。

3. **混合精度训练**：
   - 利用 **RTX 6000** 显卡的 **Tensor Cores**，通过 **FP16**（混合精度训练）加速训练，减少内存占用。

---

## 训练指标与含义

| 指标 | 含义 | 描述 |
|------|------|------|
| **训练损失 (Loss)** | 训练误差 | 衡量模型在训练数据上的拟合程度，越低越好 |
| **验证损失 (Val Loss)** | 验证误差 | 衡量模型在验证集上的泛化能力，越低越好 |
| **位置准确率 (Position Accuracy)** | 正确预测感染部位的比例 | 用于评估模型在预测感染部位任务上的精度 |
| **位置 F1 分数 (Position F1)** | 位置预测的精确度和召回率综合分数 | 更全面衡量位置任务的预测能力 |
| **等级 MAE (Grade MAE)** | 预测的病害等级与真实值之间的平均绝对误差 | 衡量等级任务预测的准确度，越低越好 |

---

## 训练日志关键数据

### 训练集：
| 指标 | 当前值 | 上一轮 | 变化幅度 | 评价 |
|------|--------|--------|----------|------|
| **训练损失** | 1.3215 | 2.0083 | **下降了 34%** | 显著进步，说明模型开始有效拟合 |
| **位置准确率** | 0.3893 | 0.3370 | **提高了 5%** | 正在逐步提升，但仍低于理想值（0.5） |
| **位置 F1 分数** | 0.3584 | 0.2901 | **提高了 7%** | 位置任务仍需优化，但已超过随机水平 |
| **等级 MAE** | 1.3864 | 1.7982 | **下降了 23%** | 病害等级预测的误差显著下降，开始更准确拟合 |

### 验证集：
| 指标 | 当前值 | 上一轮 | 变化幅度 | 评价 |
|------|--------|--------|----------|------|
| **验证损失** | 1.2371 | 1.7918 | **下降了 31%** | 验证集表现改善，模型泛化性增强 |
| **位置准确率** | 0.3956 | 0.2967 | **提升了 10%** | 位置任务有效提升，训练模型开始收敛 |
| **位置 F1 分数** | 0.3584 | 0.2901 | **提高了 7%** | 继续提升，表现比随机猜测好 |
| **等级 MAE** | 1.3926 | 1.7268 | **下降了 19%** | 验证集病害等级预测误差逐步减少，模型学习到更多规律 |

---

## 训练进展总结

- **训练损失显著下降**，验证损失也随之减少，说明模型开始从训练数据中学习到有效特征，并且能够在验证集上泛化。
- **位置准确率和 F1 分数**有了**可观提升**，但是仍然低于理想值（>0.5），这意味着模型还在学习过程中，但进展非常积极。
- **等级 MAE 下降幅度大**，说明病害等级任务开始拟合，误差缩小，接近收敛。

### **模型的泛化能力**：
- 训练集和验证集的损失都在下降，验证集的准确率提升了 10%，表明模型在**过拟合问题**上得到控制，具备了一定的**泛化能力**。

---

## 下一步策略

### 1. **继续训练**：
   - **观察第 5~10 轮**的进一步进展，特别是位置任务的准确率和 F1 分数是否能进一步提高。

### 2. **优化数据加载**：
   - 如果仍有 I/O 瓶颈，尝试增加 `num_workers`，并且使用 `.npy` 或 `.pt` 格式的数据，减少 I/O 延迟。

### 3. **标签修正**：
   - 已修正标签维度问题，确保目标标签和模型输出一致，避免再出现维度不匹配警告。

### 4. **混合精度训练**：
   - 在 RTX 6000 上开启混合精度训练，利用 **FP16** 提升训练速度和减少显存占用。
   - 检查训练速度的变化，并确认显存是否有改善。

### 5. **监控指标**：
   - 持续监控 **位置准确率** 和 **等级 MAE** 的变化，判断是否有继续优化的空间。

---

## 总结

- **整体训练进展非常正常且有明显提升**，第一轮已经显著下降，后续训练继续观察提升空间。
- 混合精度训练和标签维度修正将进一步提高模型训练效率和精度。

---

如果你需要进一步优化训练策略或配置训练流程，随时告诉我！

 
